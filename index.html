<!DOCTYPE html>
<html>
<head>
  <title>Decentralized Chat</title>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/lib/webrtc.js"></script>
  <style>
    .chat-box { height: 400px; border: 1px solid #ccc; overflow-y: scroll; }
    .message { margin: 8px; padding: 8px; border-radius: 4px; background: #f0f0f0; }
    img.preview { max-width: 200px; max-height: 200px; }
  </style>
</head>
<body>
  <div class="chat-box" id="messages"></div>
  <input type="text" id="messageInput" placeholder="Type message...">
  <input type="file" id="imageInput" accept="image/*">
  <button onclick="sendMessage()">Send</button>

  <script>
    const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
    const chat = gun.get('group-chat');

    function sendMessage() {
      const text = document.getElementById('messageInput').value;
      const file = document.getElementById('imageInput').files[0];
      
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          chat.set({ 
            type: 'image',
            data: e.target.result,
            timestamp: Date.now()
          });
        }
        reader.readAsDataURL(file);
      }
      
      if (text) {
        chat.set({ 
          text: text,
          timestamp: Date.now()
        });
        document.getElementById('messageInput').value = '';
      }
    }

    chat.map().on((data, id) => {
      const div = document.createElement('div');
      div.className = 'message';
      
      if (data.type === 'image') {
        const img = document.createElement('img');
        img.src = data.data;
        img.className = 'preview';
        div.appendChild(img);
      } else {
        div.textContent = data.text;
      }
      
      document.getElementById('messages').appendChild(div);
    });
  </script>
</body>
</html>
